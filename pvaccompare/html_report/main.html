<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="ico" href="favicon.ico">
    <link rel="stylesheet" href="libs/quasar/quasar.prod.css">
    <link rel="stylesheet" href="libs/bootstrap/bootstrap.min.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <title>pVACcompare - Report</title>
</head>
<body>
    <div id="app">
        <directory-selection
            v-if="!selectedDirectory"
            @directory-selected="onDirectorySelected">
        </directory-selection>
        <template v-if="selectedDirectory">
            <navbar
                :current-page-id="currentPageId"
                :current-class="currentClass"
                :comparison-items="comparisonItems"
                :has-mhc-class-i="hasMhcClassI"
                :has-mhc-class-i-i="hasMhcClassII"
                @change-directory="onDirectoryChanged"
                @change-page="onPageChanged"
                @change-class="onClassChanged">
            </navbar>
            <header-template
                :current-directory="currentDirectory"
                :current-page-id="currentPageId"
                :current-comparison="currentComparison"
                :comparison-items="comparisonItems"
                :aggregated-data="aggregatedData"
                :unaggregated-data="unaggregatedData"
                :input-yml-data="inputYmlData"
                :json-input-data="jsonInputData"
                :reference-matches-data="referenceMatchesData">
            </header-template>
            <summary-template
                :current-page-id="currentPageId"
                :current-comparison="currentComparison"
                :comparison-items="comparisonItems"
                :aggregated-data="aggregatedData"
                :unaggregated-data="unaggregatedData"
                :input-yml-data="inputYmlData"
                :json-input-data="jsonInputData"
                :reference-matches-data="referenceMatchesData">
            </summary-template>
            <differences-template
                :current-page-id="currentPageId"
                :current-comparison="currentComparison"
                :comparison-items="comparisonItems"
                :aggregated-data="aggregatedData"
                :unaggregated-data="unaggregatedData"
                :input-yml-data="inputYmlData"
                :json-input-data="jsonInputData"
                :reference-matches-data="referenceMatchesData"
                :has-unique-variants="hasUniqueVariants">
            </differences-template>
            <variants-template
                :current-page-id="currentPageId"
                :current-comparison="currentComparison"
                :comparison-items="comparisonItems"
                :aggregated-data="aggregatedData"
                :unaggregated-data="unaggregatedData"
                :input-yml-data="inputYmlData"
                :json-input-data="jsonInputData"
                :reference-matches-data="referenceMatchesData"
                @has-unique-variants-changed="onHasUniqueVariantsChanged">
            </variants-template>
        </template>
    </div>

    <script src="vue.global.js"></script>
    <script src="libs/bootstrap/bootstrap.bundle.min.js"></script>
    <script src="libs/quasar/quasar.umd.prod.js"></script>
    <script>
        const app = Vue.createApp({
            data() {
                return {
                    selectedDirectory: false,
                    currentDirectory: null,
                    currentPageId: 0,
                    currentClass: 1,
                    comparisonItems: [],
                    mhcClassI: [],
                    mhcClassII: [],
                    aggregatedData: null,
                    unaggregatedData: null,
                    inputYmlData: null,
                    jsonInputData: null,
                    referenceMatchesData: null,
                    hasUniqueVariants: false,
                };
            },

            computed: {
                currentComparison() {
                    const item = this.comparisonItems[this.currentPageId];
                    return item ? item : "Unavailable";
                },

                hasMhcClassI() {
                    return this.mhcClassI.length > 0;
                },

                hasMhcClassII() {
                    return this.mhcClassII.length > 0;
                },
            },

            methods: {
                onDirectoryChanged() {
                    this.selectedDirectory = false;
                    this.currentDirectory = null;
                    this.currentPageId = 0;
                    this.currentClass = 1;
                    this.comparisonItems = [];
                    this.mhcClassI = [];
                    this.mhcClassII = [];
                    this.aggregatedData = null;
                    this.unaggregatedData = null;
                    this.inputYmlData = null;
                    this.jsonInputData = null;
                    this.referenceMatchesData = null;
                    this.hasUniqueVariants = false;
                },

                onDirectorySelected(directory, files, mhcClassI, mhcClassII) {
                    this.selectedDirectory = true;
                    this.currentDirectory = directory;
                    this.currentClass = mhcClassI.length === 0 ? 2: 1;
                    this.mhcClassI = mhcClassI;
                    this.mhcClassII = mhcClassII;
                    this.loadJsonFiles();
                    this.$nextTick(() => {
                        this.updateComparisonItems();
                    });
                },

                onPageChanged(id) {
                    this.currentPageId = id;
                },

                onClassChanged(id) {
                    this.currentClass = id;
                    this.currentPageId = 0;

                    this.aggregatedData = null;
                    this.unaggregatedData = null;
                    this.inputYmlData = null;
                    this.jsonInputData = null;
                    this.referenceMatchesData = null;

                    this.loadJsonFiles();
                    this.updateComparisonItems();
                },

                onHasUniqueVariantsChanged(value) {
                    this.hasUniqueVariants = value;
                },

                loadJsonFiles() {
                    const filesToLoad = (this.currentClass === 1) ? this.mhcClassI : this.mhcClassII;

                    for (const file of filesToLoad) {
                        this[file.key] = JSON.parse(file.content);
                    }
                },

                updateComparisonItems() {
                    let count = 0;
                    const items = [];
                    if (this.inputYmlData) {
                        items.push({ id: count++, key: "inputYmlData", file: "log/inputs.yml", name: "Input YML Report" });
                    }
                    if (this.unaggregatedData) {
                        items.push({ id: count++, key: "unaggregatedData", file: "all_epitopes.tsv", name: "All Epitopes Report" });
                    }
                    if (this.aggregatedData) {
                        items.push({ id: count++, key: "aggregatedData", file: "all_epitopes.aggregated.tsv", name: "Aggregated Epitopes Report" });
                    }
                    if (this.referenceMatchesData) {
                        items.push({ id: count++, key: "referenceMatchesData", file: "all_epitopes.aggregated.tsv.reference_matches", name: "Reference Matches Report" });
                    }
                    if (this.jsonInputData) {
                        items.push({ id: count++, key: "jsonInputData", file: "all_epitopes.aggregated.metrics.json", name: "Metrics JSON Report" });
                    }
                    this.comparisonItems = items;
                }
            }
        });

        app.component('directory-selection', {
            template: `
                <div>
                    <div class="bg-dark text-white text-left py-4 px-2 shadow-sm">
                        <h1 class="display-4 mb-0"><strong>pVACcompare</strong></h1>
                    </div>
                    <div class="mx-5 mt-5">
                        <h2>Select Results Folder</h2>
                        <p class="confirm-access-msg"><i>You will be asked to confirm directory access. This is a browser security feature.</i></p>
                        <div class="input-group mb-3 mt-4">
                            <input
                                ref="directoryInput"
                                type="file"
                                webkitdirectory
                                directory
                                class="form-control custom-border"
                                @change="onDirectorySelected"
                            />
                        </div>

                        <div v-if="selectedDirectory" class="mt-3">
                            <q-card flat>
                                <q-card-section>
                                    <div class="text-h6">Selected Directory:</div>
                                    <div class="text-subtitle2">{{ selectedDirectory }}</div>
                                </q-card-section>
                            </q-card>
                            <q-card flat>
                                <q-card-section v-if="filesInDirectory.length > 0">
                                    <div class="text-h6">Files Found in Directory:</div>
                                    <ul>
                                        <li v-for="file in filesInDirectory" :key="file.id">{{ file.name }}</li>
                                    </ul>
                                </q-card-section>
                            </q-card>
                        </div>

                        <q-btn
                            v-if="selectedDirectory"
                            class="q-mt-md"
                            label="Confirm and Load Files"
                            color="primary"
                            @click="confirmSelection"
                        />
                    </div>
                </div>
            `,
            data() {
                return {
                    filesInDirectory: [],
                    validFilesInDirectory: [],
                    selectedDirectory: null,
                };
            },
            methods: {
                onDirectorySelected(event) {
                    const files = event.target.files;

                    if (files.length > 0) {
                        const path = files[0].webkitRelativePath.split('/')[0];
                        this.selectedDirectory = path;

                        const fileKeyMap = {
                            'yml_input_data.json': 'inputYmlData',
                            'unaggregated_data.json': 'unaggregatedData',
                            'aggregated_data.json': 'aggregatedData',
                            'reference_matches_data.json': 'referenceMatchesData',
                            'json_input_data.json': 'jsonInputData',
                        };

                        Array.from(files).forEach((file, index) => {
                            const key = fileKeyMap[file.name] || null;
                            const reader = new FileReader();
                            reader.onload = (e) => {
                                this.filesInDirectory.push({
                                    id: index,
                                    name: file.name,
                                    content: e.target.result,
                                    key,
                                });
                            };
                            reader.readAsText(file);
                        });
                    } else {
                        this.$q.notify({
                            type: 'negative',
                            message: `Error: The selected directory is empty`,
                        });
                        this.selectedDirectory = null;
                        this.filesInDirectory = [];
                    }
                },

                confirmSelection() {
                    if (!this.selectedDirectory) {
                        this.$q.notify({
                            type: 'negative',
                            message: 'Error: Please select a directory',
                        });
                        return;
                    }

                    const validFileNames = [
                        'aggregated_data.json',
                        'json_input_data.json',
                        'reference_matches_data.json',
                        'unaggregated_data.json',
                        'yml_input_data.json'
                    ]

                    this.validFilesInDirectory = this.filesInDirectory.filter(file => validFileNames.includes(file.name));
                    if (this.validFilesInDirectory.length === 0) {
                        this.$q.notify({
                            type: 'negative',
                            message: `Error: No valid files were found in the selected directory`,
                        });
                        return;
                    }
                    const mhcClassI = [];
                    const mhcClassII = [];

                    for (const file of this.validFilesInDirectory) {
                        if (file.content) {
                            const jsonData = JSON.parse(file.content);
                            if (jsonData.mhc_class === "1") {
                                if (mhcClassI.some(existingFile => existingFile.name === file.name)) {
                                    this.$q.notify({
                                        type: 'negative',
                                        message: `Error: Duplicate file detected in MHC Class I - ${file.name}`,
                                    });
                                    return;
                                }
                                mhcClassI.push(file);
                            } else if (jsonData.mhc_class === "2") {
                                if (mhcClassII.some(existingFile => existingFile.name === file.name)) {
                                    this.$q.notify({
                                        type: 'negative',
                                        message: `Error: Duplicate file detected in MHC Class II - ${file.name}`,
                                    });
                                    return;
                                }
                                mhcClassII.push(file);
                            } else {
                                console.warning(`File ${file.name} does not contain a valid mhc_class`);
                            }
                        } else {
                            console.warn(`File ${file.name} has no content.`);
                        }
                    }

                    this.$emit('directory-selected', this.selectedDirectory, this.validFilesInDirectory, mhcClassI, mhcClassII);
                    this.$q.notify({
                        type: 'positive',
                        message: 'Files loaded successfully',
                    });
                },
            },
        });

        app.component('navbar', {
            template: `
                <div>
                    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
                        <a class="navbar-brand px-2" href="#" @click="changeCurrentDirectory">pVACcompare</a>
                        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                            <span class="navbar-toggler-icon"></span>
                        </button>
                        <div class="collapse navbar-collapse" id="navbarNav">
                            <ul class="navbar-nav">
                                <li class="nav-item" v-for="item in comparisonItems" :key="item.id" :class="{ active: item.id === currentPageId }">
                                    <a class="nav-link" href="#" @click="changeCurrentPage(item.id)">{{ item.file }}</a>
                                </li>
                            </ul>
                        </div>
                        <div class="dropdown ms-auto px-2" ref="dropdown">
                            <button class="btn btn-secondary dropdown-toggle" type="button" @click="toggleDropdown">
                                {{ currentClass === 1 ? 'MHC Class I' : 'MHC Class II' }}
                            </button>
                            <ul class="dropdown-menu" :class="{ show: isDropdownOpen }">
                                <li v-if="hasMhcClassI"><a class="dropdown-item" href="#" @click="changeClass(1)">MHC Class I</a></li>
                                <li v-if="hasMhcClassII"><a class="dropdown-item" href="#" @click="changeClass(2)">MHC Class II</a></li>
                            </ul>
                        </div>
                    </nav>
                </div>
            `,
            props: [
                'currentPageId',
                'currentClass',
                'comparisonItems',
                'hasMhcClassI',
                'hasMhcClassII'
            ],

            data() {
                return {
                    isDropdownOpen: false,
                };
            },

            methods: {
                changeCurrentDirectory() {
                    this.$emit('change-directory');
                },

                changeCurrentPage(id) {
                    this.$emit('change-page', id);
                },

                toggleDropdown() {
                    this.isDropdownOpen = !this.isDropdownOpen;
                },

                changeClass(classId) {
                    this.isDropdownOpen = false;
                    this.$emit('change-class', classId);
                },

                closeDropdownIfOutside(event) {
                    const dropdown = this.$refs.dropdown;
                    if (dropdown && !dropdown.contains(event.target) && this.isDropdownOpen) {
                        this.isDropdownOpen = false;
                    }
                }
            },
            mounted() {
                document.addEventListener('click', this.closeDropdownIfOutside);
            },

            beforeUnmount() {
                document.removeEventListener('click', this.closeDropdownIfOutside);
            }
        });

        app.component('header-template', {
            template: `
                <div class="mx-5 mt-4">
                    <p><strong>Selected Directory:</strong> {{ currentDirectory }}</p>
                    <h1><u>{{ currentComparison.name }}</u></h1>
                    <div class="mx-3">
                        <ul class="list-unstyled">
                            <li><strong>File 1:</strong> {{ inputFile1 }}</li>
                            <li><strong>File 2:</strong> {{ inputFile2 }}</li>
                        </ul>
                    </div>
                </div>
            `,
            props: [
                'currentDirectory',
                'currentPageId',
                'currentComparison',
                'comparisonItems',
                'aggregatedData',
                'unaggregatedData',
                'inputYmlData',
                'jsonInputData',
                'referenceMatchesData'
            ],
            computed: {
                inputFile1() {
                    const item = this.comparisonItems[this.currentPageId];
                    return item && this[item.key] ? this[item.key].input_file1 : "Unavailable";
                },

                inputFile2() {
                    const item = this.comparisonItems[this.currentPageId];
                    return item && this[item.key] ? this[item.key].input_file2 : "Unavailable";
                }
            }
        });

        app.component('summary-template', {
            template: `
                <div class="mx-5 mt-4">
                    <div v-if="displaySummary" class="d-flex align-items-center">
                        <h3>Summary</h3>
                        <button class="btn btn-primary btn-sm m-2" @click.prevent="toggleHideSummary">
                            {{ hide_summary ? 'Show' : 'Hide' }}
                        </button>
                    </div>
                    <div v-if="!hide_summary" class="mx-4">
                        <div v-for="(entries, section) in summary" :key="section">
                            <template v-if="Object.keys(entries).length > 0">
                                <div class="summary-notes" v-if="section === 'Notes'">
                                    <ul>
                                        <li v-for="(value, index) in entries" :key="index">{{ value }}</li>
                                    </ul>
                                </div>
                                <div v-else>
                                    <h4><u>{{ section }}</u></h4>
                                    <ul>
                                        <li v-for="(value, field) in entries" :key="field">{{ field }}: {{ value }}</li>
                                    </ul>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>
            `,
            props: [
                'currentPageId',
                'currentComparison',
                'comparisonItems',
                'aggregatedData',
                'unaggregatedData',
                'inputYmlData',
                'jsonInputData',
                'referenceMatchesData'
            ],
            data() {
                return {
                    hide_summary: false,
                    summary: {}
                };
            },

            computed: {
                displaySummary() {
                    return this.currentComparison.key !== 'inputYmlData' && this.currentComparison.key !== 'jsonInputData';
                }
            },

            watch: {
                comparisonItems: function(items) {
                    if (items.length > 0) {
                        this.loadSummary();
                    }
                },
                currentPageId(newPageId, oldPageId) {
                    if (newPageId !== oldPageId) {
                        this.loadSummary();
                    }
                }
            },

            methods: {
                toggleHideSummary() {
                    this.hide_summary = !this.hide_summary;
                },

                loadSummary() {
                    const key = this.currentComparison.key;
                    if (!this[key] || !this[key].summary) {
                        return null;
                    }

                    const summary = this[key].summary;
                    if (key === 'inputYmlData') {
                        this.summary = {};
                    } else if (key == 'jsonInputData') {
                        this.summary = {};
                    }
                    this.summary = summary;
                }
            }
        });

        app.component('differences-template', {
            template: `
                <div v-if="Object.keys(differences).length" class="mx-5 mt-5">
                    <h1>Differences</h1>
                    <div class="mx-4">
                        <div class="mt-3" v-for="(entries, section) in differences" :key="section">
                            <template v-if="entries && Object.keys(entries).length">
                                <h4 v-if="entries"><u>{{ section }}</u></h4>
                                <div v-if="tableNeeded" class="q-pa-md">
                                    <q-virtual-scroll
                                        type="table"
                                        style="max-height: 70vh"
                                        :virtual-scroll-item-size="48"
                                        :virtual-scroll-sticky-size-start="48"
                                        :items="visibleEntries[section] || []"
                                        @virtual-scroll="(e) => onVirtualScroll(section, e)"
                                    >
                                        <template v-slot:before>
                                            <thead class="thead-sticky text-left">
                                                <tr>
                                                    <th v-for="field in fields" :key="field">
                                                        <q-tooltip v-if="field === 'ID'" anchor="top middle" self="top middle">
                                                            {{ idFormat }}
                                                        </q-tooltip>
                                                        {{ field }}
                                                    </th>
                                                </tr>
                                            </thead>
                                        </template>
                                        <template v-slot="{ item: row }">
                                            <tr class="table-item" v-for="entry in [row]" :key="entry.ID">
                                                <td v-for="(value, field) in entry" :key="field">
                                                    {{ value ? value: "NA" }}
                                                </td>
                                            </tr>
                                        </template>
                                    </q-virtual-scroll>
                                </div>
                                <div v-else>
                                    <ul>
                                        <li v-for="(value, field) in entries" :key="field">
                                            <template v-if="Array.isArray(entries)">
                                                {{ value }}
                                            </template>
                                            <template v-else-if="typeof value === 'object' && !Array.isArray(value)">
                                                {{ field }}
                                                <ul>
                                                    <li v-for="(subValue, subField) in value" :key="subField">
                                                        {{ subField }}: {{ subValue }}
                                                    </li>
                                                </ul>
                                            </template>
                                            <template v-else>
                                                {{ field ? field + ': ' + value : value }}
                                            </template>
                                        </li>
                                    </ul>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>
                <div v-else-if="!hasUniqueVariants" class="identical-msg mx-5 mt-5">
                    <h4>The files are identical</h4>
                </div>
            `,
            props: [
                'currentPageId',
                'currentComparison',
                'comparisonItems',
                'aggregatedData',
                'unaggregatedData',
                'inputYmlData',
                'jsonInputData',
                'referenceMatchesData',
                'hasUniqueVariants'
            ],

            data() {
                return {
                    visibleEntries: {},
                    loadedSections: {},
                    currentSectionIndex: {},
                    loadBatchSize: 1000,
                    fields: ["ID", "File 1 Value", "File 2 Value", "File 1 Line", "File 2 Line"],
                    idFormat: ""
                };
            },

            computed: {
                differences() {
                    return this.getDifferences();
                },

                tableNeeded() {
                    if (this.currentComparison !== "Unavailable") {
                        return this.currentComparison.key !== 'inputYmlData' && this.currentComparison.key !== 'jsonInputData';
                    }
                    return false;
                }
            },

            watch: {
                comparisonItems: function(items) {
                    if (items.length > 0) {
                        this.initializeData();
                    }
                },
                currentPageId(newPageId, oldPageId) {
                    if (newPageId !== oldPageId) {
                        this.initializeData();
                    }
                }
            },

            methods: {
                getDifferences() {
                    if (this.currentComparison === "Unavailable") {
                        return {};
                    }

                    const key = this.currentComparison.key;
                    if (!this[key] || !this[key].differences) {
                        return {};
                    }

                    const differences = this[key].differences;
                    const formattedDifferences = {};

                    for (const section in differences) {
                        const sectionData = differences[section];

                        if (Array.isArray(sectionData)) {
                            formattedDifferences[section] = sectionData;
                        } else if (typeof sectionData === 'object') {
                            formattedDifferences[section] = {};

                            for (const nestedKey in sectionData) {
                                const nestedData = sectionData[nestedKey];

                                if (Array.isArray(nestedData)) {
                                    formattedDifferences[section][nestedKey] = nestedData;
                                } else if (typeof nestedData === 'object') {
                                    formattedDifferences[section][nestedKey] = nestedData;
                                } else {
                                    formattedDifferences[section][nestedKey] = nestedData;
                                }
                            }
                        }
                    }

                    return formattedDifferences;
                },

                initializeData() {
                    if (this.currentComparison === "Unavailable") {
                        return;
                    }

                    const key = this.currentComparison.key;
                    if (this[key] && this[key].differences) {
                        this.idFormat = this[key].id_format;
                        this.visibleEntries = {};
                        this.loadedSections = {};
                        this.currentSectionIndex = {};

                        for (const section in this[key].differences) {
                            this.visibleEntries[section] = [];
                            this.loadedSections[section] = 0;
                            this.currentSectionIndex[section] = 1;

                            this.loadSection(section);
                        }
                    }
                },

                loadSection(section) {
                    const key = this.currentComparison.key;
                    const sectionData = this[key]?.differences?.[section];
                    if (!sectionData || this.currentSectionIndex[section] > sectionData.num_sections) {
                        return;
                    }

                    const sectionKey = `section${this.currentSectionIndex[section]}`;
                    const newEntries = sectionData[sectionKey] || [];
                    this.visibleEntries[section] = [...this.visibleEntries[section], ...newEntries];
                    this.currentSectionIndex[section]++;
                },

                onVirtualScroll(section, e) {
                    const bottomReached = e.index >= this.visibleEntries[section]?.length - 1;
                    if (bottomReached) {
                        this.loadSection(section);
                    }
                },
            }
        });

        app.component('variants-template', {
            template: `
                <div v-if="hasUniqueVariants" class="mx-5 mt-5">
                    <h1>Variants</h1>
                    <div class="mx-4">
                        <div class="mt-3" v-for="(entries, section) in unique_variants" :key="section">
                            <template v-if="entries && Object.keys(entries).length">
                                <h4 v-if="entries"><u>{{ section }}</u></h4>
                                <div class="q-pa-md">
                                    <q-virtual-scroll
                                        type="table"
                                        style="max-height: 70vh"
                                        :virtual-scroll-item-size="48"
                                        :virtual-scroll-sticky-size-start="48"
                                        :items="formattedEntries(entries)"
                                    >
                                        <template v-slot:before>
                                            <thead class="thead-sticky text-left">
                                                <tr>
                                                    <th>
                                                        ID
                                                        <q-tooltip anchor="top middle" self="top middle">
                                                            {{ idFormat }}
                                                        </q-tooltip>
                                                    </th>
                                                    <th v-if="!Array.isArray(entries)">
                                                        Number of Hits    
                                                    </th>
                                                </tr>
                                            </thead>
                                        </template>
                                        <template v-slot="{ item: row }">
                                            <tr class="table-item">
                                                <template v-if="row.value">
                                                    <td colspan="2">{{ row.value }}</td>
                                                </template>
                                                <template v-else-if="row.hits">
                                                    <td>{{ row.id }}</td>
                                                    <td>{{ row.hits }}</td>
                                                </template>
                                                <template v-else>
                                                    <td colspan="2">No data available</td>
                                                </template>
                                            </tr>
                                        </template>
                                    </q-virtual-scroll>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>
            `,
            props: [
                'currentPageId',
                'currentComparison',
                'comparisonItems',
                'aggregatedData',
                'unaggregatedData',
                'inputYmlData',
                'jsonInputData',
                'referenceMatchesData'
            ],
            data() {
                return {
                    unique_variants: {},
                    idFormat: ""
                };
            },

            computed: {
                hasUniqueVariants() {
                    return Object.values(this.unique_variants).some(
                        (entries) => Array.isArray(entries) ? entries.length > 0 : Object.keys(entries).length > 0
                    );
                }
            },

            watch: {
                comparisonItems: function(items) {
                    if (items.length > 0) {
                        this.loadVariants();
                    }
                },
                currentPageId(newPageId, oldPageId) {
                    if (newPageId !== oldPageId) {
                        this.loadVariants();
                    }
                },
                hasUniqueVariants: function(value) {
                    this.$emit('has-unique-variants-changed', value);
                }
            },

            methods: {
                loadVariants() {
                    const key = this.currentComparison.key;
                    if (!this[key] || !this[key].variants) {
                        return null;
                    }

                    this.idFormat = this[key].id_format;
                    const unique_variants = this[key].variants;
                    if (key === 'inputYmlData' || key === 'jsonInputData') {
                        this.unique_variants = {};
                    }
                    this.unique_variants = unique_variants;
                },

                formattedEntries(entries) {
                    if (typeof entries === 'object' && !Array.isArray(entries)) {
                        return Object.entries(entries).map(([id, hits]) => ({ id, hits }));
                    } else if (Array.isArray(entries)) {
                        return entries.map((value, index) => ({ id: index + 1, value }));
                    }
                    return entries;
                }
            }
        });

        app.use(Quasar);
        app.mount('#app');
    </script>
</body>
</html>

<style>
.confirm-access-msg {
    opacity: 0.75;
}

.custom-border {
    border: 1px solid darkgray;
    width: 100%;
}

.navbar-brand:hover {
    color: darkgray;
}

.navbar-nav .nav-item.active .nav-link {
    color: white;
}

.thead-sticky {
    position: sticky;
    top: 0;
    background: black;
    color: white;
    z-index: 1;
}

.thead-sticky th {
    font-size: 1rem;
}

.summary-notes {
    color: red;
}

.table-item {
    background: rgb(50, 50, 50);
    color: white;
}

.table-item td {
    font-size: 1rem !important;
}

.identical-msg {
    color: lime;
}
</style>